sudo: false

language: cpp

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - cmake
      - libblas-dev
      - liblapack-dev
      - gfortran-7
      - libopenmpi-dev

dist: bionic

compiler: gcc

branches:
  only:
    - master

before_install:
  - sudo add-apt-repository ppa:ubuntu-toolchain-r/test -y
  - sudo apt-get update -q
  # Install elemental
  - git clone --branch master git://github.com/elemental/Elemental.git ${HOME}/elemental
  - ls /usr/lib/gcc/x86_64-linux-gnu/7
  - |
    cd ${HOME}/elemental && 
    cmake -H. -Bbuild -DCMAKE_INSTALL_PREFIX=/usr/bin/gfortran-7 -DCMAKE_Fortran_COMPILER=${HOME}/local -DGFORTRAN_LIB=/usr/lib/gcc/x86_64-linux-gnu/7 && 
    cmake --build build --target install 
script:
  - cmake -H. -Bbuild
  - cmake --build build
  - ctest --output-on-failure